{{ define "main" }}
  {{ .Scratch.Set "scope" "single" }}

  {{ $category := "" }}
  {{ with .Params.categories }}
    {{ $category = index . 0 }}
  {{ end }}

  <article class="v0-container">
    <div class="article-layout">
      <article>
        <header class="article-header">
          <div class="article-meta-row">
            <span>[{{ .Date | time.Format "2006-01-02" }}]</span>
            {{ with $category }}
              <span>[Category: {{ . }}]</span>
            {{ end }}
          </div>
          <h1 class="article-main-title">
            {{ .Title | emojify }}
          </h1>
          {{ with .Params.tags }}
            <div class="v0-article-tags-row">
              {{ range . }}
                <span class="v0-article-tag">#{{ . }}</span>
              {{ end }}
            </div>
          {{ end }}
        </header>

        <div class="article-content prose dark:prose-invert prose-lg max-w-none">
          {{ .Content }}
        </div>

        {{ with .Params.tags }}
          <div class="mt-10 pt-6 border-t border-neutral-800">
            <div class="flex flex-wrap items-center gap-2 text-sm">
              <span class="text-neutral-500 mr-2">Tags:</span>
              {{ range . }}
                <a href='{{ (printf "/tags/%s/" (urlize .)) | relLangURL }}' class='text-xs bg-neutral-900 text-neutral-300 px-3 py-1 rounded-full hover:bg-neutral-700 hover:text-neutral transition-colors'>
                  #{{ . }}
                </a>
              {{ end }}
            </div>
          </div>
        {{ end }}

        {{/* 保留 Blowfish 统计脚本，防止功能丢失 */}}
        {{ $translations := .AllTranslations }}
        {{ with .File }}
          {{ $path := .Path }}
          {{ range $translations }}
            {{ $lang := print "."  .Lang  ".md" }}
            {{ $path = replace $path $lang ".md" }}
          {{ end }}
          {{ $jsPage := resources.Get "js/page.js" }}
          {{ $jsPage = $jsPage | resources.Minify | resources.Fingerprint (site.Params.fingerprintAlgorithm | default "sha512") }}
          <script
            type='text/javascript'
            src='{{ $jsPage.RelPermalink }}'
            integrity='{{ $jsPage.Data.Integrity }}'
            data-oid='views_{{ $path }}'
            data-oid-likes='likes_{{ $path }}'></script>
        {{ end }}
      </article>

      <aside class="toc-sidebar">
        {{ with .TableOfContents }}
          <div class="toc-container">
            <div class="toc-title">// 导航 [INDEX]</div>
            {{ . | safeHTML }}
          </div>
        {{ end }}
      </aside>
    </div>
  </article>
{{ end }}
